---
title: "Term 4 - Time Series Group Project - Air Quality "
author: "Jay Bektasevic, Andrew Brill, Adam Sampson, Brenden McGale, Taylor Maxon"
date: "February 9, 2018"
output: 
  prettydoc::html_pretty:
    theme: architect
    highlight: github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


###  Load Required Packages and Files  

```{r eval=TRUE, message=FALSE, warning=FALSE, include=TRUE, results='hide'}
#   Check that necessary packages are installed
    packages <- c("tidyverse", "lubridate", "xts", "corrplot", "readxl")
    new_packages <- packages[!(packages %in% installed.packages()[,"Package"])]
    if(length(new_packages)) install.packages(new_packages)

#   Load Neccessary Packages
    sapply(packages, require, character.only = TRUE)
```

###  Introduction
What is Air Pollutions, what causes it?

Particulate matter
Fine particulate matter is a broad term used for an airborne mixture of solid particles and liquid droplets. These particles are <= 2.5 microns in diameter and, although the composition is region-specific, are largely made up of sulphate, nitrate, carbon particles and soil. Fine particles are produced from all types of combustion, including motor vehicles, power plants, residential wood burning, forest fires, agricultural burning, and some industrial processes.
 
 
Along with ground-level ozone, fine particulate matter is one of the two major components of smog.
 
From a human perspective, excess fine particulates pose hazards for people with asthma, cardiovascular or lung disease, as well as children and the elderly. These health effects have been associated with both short term (daily) and long term (>year) exposure. However, even if you are healthy, you may feel temporary symptoms if you are exposed to high levels of particle pollution. Numerous scientific studies connect particle pollution exposure to a variety of health issues, including:
    
*   irritation of the eyes, nose and throat
*   coughing, chest tightness and shortness of breath
*   reduced lung function
*   irregular heartbeat
*   asthma attacks
*   heart attacks
*   premature death in people with heart or lung disease

Ecologically, fine particulate matter can damage vegetation and can lead to soil erosion.

The EPA has set National Ambient Air Quality Standards for six principal pollutants found [here](https://www.epa.gov/criteria-air-pollutants/naaqs-table).


###  Collect Data
Data was aquired from the EPA website there are several monitoring stations in Jefferson County.
```{r eval=FALSE, message=FALSE, warning=FALSE, include=TRUE, paged.print=FALSE}
#   Gather all the files in the directory
    temp <- list.files(pattern="*.csv")

#  Read in all the files and bind them together
   EPA_data <- lapply(temp, function(x) read.csv(x, stringsAsFactors = FALSE)) %>% bind_rows()
   
   save(EPA_data, file = "EPA.Rdata")

```

###  Exploratory Analysis

```{r eval=FALSE, message=FALSE, warning=FALSE, include=TRUE, paged.print=FALSE}
    summary(EPA_data)
    corrplot(cor(EPA_data),method="number")

    
    
#  create time series
    EPA_ts <- EPA_data %>% select(Date, Measurement, DAILY_AQI_VALUE, DAILY_OBS_COUNT, AQS_PARAMETER_CODE )

    EPA_ts <- ts(EPA_ts, start = c(1990, 1), end = c(2017,12),  frequency = 365)

    plot(EPA_ts)

```



```{r echo=TRUE}
    
    load("EPA_data.Rdata")
    #EPA_data <- read_excel("EPA_data.xlsx")

#   Choose two years to compare. Also, this will average the measurements accross all sites.

    ozone <- EPA_data[EPA_data$AQS_PARAMETER_DESC =="Ozone", ] %>% 
            group_by(Date) %>% 
            summarise(avg.measurement = mean( Measurement ))
    
    so2 <- EPA_data[EPA_data$AQS_PARAMETER_DESC =="Sulfur dioxide", ] %>% 
            group_by(Date) %>% 
            summarise(avg.measurement = mean( Measurement ))
    
    pm2.5 <- EPA_data[EPA_data$AQS_PARAMETER_DESC =="PM2.5 - Local Conditions", ]%>% 
            group_by(Date) %>% 
            summarise(avg.measurement = mean( Measurement ))
    
    AQI <- EPA_data %>% select(Date, DAILY_AQI_VALUE) %>% 
            group_by(Date) %>% 
            summarise(avg.measurement = mean( DAILY_AQI_VALUE ))
   
    
  

    #par(mfrow = c(4, 1))
    plot(ozone$Date , ozone$avg.measurement , pch = 20, xlim = range(ozone$Date, na.rm = TRUE), 
         ylim = range(ozone$avg.measurement, na.rm = T), xlab = "", ylab = "ppm")
    title("Ozone 1990 - 2017")
    abline(h = median(ozone$avg.measurement, na.rm = T), col = "blue")
    abline(h = 0.070, col = "red")
    
    plot(so2$Date , so2$avg.measurement , pch = 20, xlim = range(so2$Date, na.rm = TRUE), 
         ylim = range(so2$avg.measurement, na.rm = T), xlab = "", ylab = "ppm")
    title("Sulfur Dioxide 1990 - 2017")
    abline(h = median(so2$avg.measurement, na.rm = T), col = "blue")
    abline(h = 75, col = "red")
    
    plot(pm2.5$Date,pm2.5$avg.measurement , pch = 20, xlim = range(pm2.5$Date, na.rm = TRUE), 
         ylim = range(pm2.5$avg.measurement, na.rm = T), xlab = "", 
         ylab = expression(PM[2.5] * " (" * mu * g/m^3 * ")"))
    title("PM2.5 2000 - 2017")
    abline(h = median(pm2.5$avg.measurement, na.rm = T), col = "blue")
    abline(h = 12.0, col = "red") # Treshold
    
     plot(AQI$Date,AQI$avg.measurement , pch = 20, xlim = range(AQI$Date, na.rm = TRUE), 
         ylim = range(AQI$avg.measurement, na.rm = T), xlab = "", 
         ylab = "Air Quality Index 1990 - 2017")
    title("Air Quality Index")
    abline(h = median(AQI$avg.measurement, na.rm = T), col = "blue")
    abline(h = 50, col = "red")
```

### Seasonal Variation




### Correlations with other pollutants